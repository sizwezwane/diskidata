<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiskiData - Premium Football Insights (Material)</title>
    <!-- Roboto Font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #fbfbfb;
            font-family: 'Roboto', sans-serif;
        }

        .navbar {
            background-color: #1a237e !important;
            /* Indigo 900 */
        }

        .hero-section {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: white;
            padding: 80px 0;
            margin-bottom: 40px;
        }

        .player-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
        }

        .modal-header {
            background-color: #1a237e;
            color: white;
        }

        .btn-primary {
            background-color: #1a237e;
        }

        .stats-badge {
            font-size: 0.8rem;
            padding: 0.5em 1em;
            border-radius: 20px;
        }

        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        .market-value-text {
            color: #2e7d32;
            /* Material Green 800 */
            font-weight: 700;
        }
    </style>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark shadow-5">
        <div class="container">
            <a class="navbar-brand font-weight-bold" href="#" onclick="location.reload()">
                <i class="fas fa-trophy me-2"></i> DiskiData
            </a>
            <div class="d-flex align-items-center">
                <button type="button" class="btn btn-link px-3 me-2 text-white">Login</button>
                <button type="button" class="btn btn-warning me-3">Go Pro</button>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <div class="hero-section text-center">
        <div class="container">
            <h1 class="display-3 fw-bold mb-4">Football Analytics Engine</h1>
            <p class="lead mb-5">Deep scouting, valuations, and performance metrics.</p>

            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="input-group input-group-lg bg-white rounded-pill overflow-hidden p-1 shadow-3">
                        <span class="input-group-text border-0 bg-transparent ps-4">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" id="playerSearch" class="form-control border-0 shadow-none"
                            placeholder="Enter player name (e.g. Messi)"
                            onkeyup="if(event.key === 'Enter') searchPlayers()">
                        <button class="btn btn-primary rounded-pill px-5 ms-2" type="button" onclick="searchPlayers()">
                            Search
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container pb-5">
        <div id="resultsGrid" class="row g-4">
            <!-- Initial Placeholder -->
            <div id="placeholder" class="col-12 text-center py-5 opacity-50">
                <i class="fas fa-database fa-4x mb-3 text-muted"></i>
                <p class="h5">Global Transfermarkt database ready.</p>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="d-none">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="playerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold" id="modalTitle">Player Profile</h5>
                    <button type="button" class="btn-close btn-close-white" data-mdb-ripple-init
                        data-mdb-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4" id="modalContent">
                    <!-- Data will be injected -->
                </div>
            </div>
        </div>
    </div>

    <!-- MDB -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.umd.min.js"></script>

    <script>
        const playerModal = new mdb.Modal(document.getElementById('playerModal'));

        function formatMarketValue(val) {
            if (!val) return 'N/A';
            if (val >= 1000000) return `€${(val / 1000000).toFixed(2)}M`;
            if (val >= 1000) return `€${(val / 1000).toFixed(0)}K`;
            return `€${val}`;
        }

        async function searchPlayers() {
            const query = document.getElementById('playerSearch').value;
            if (!query) return;

            document.getElementById('placeholder')?.classList.add('d-none');
            document.getElementById('loading').classList.remove('d-none');
            document.getElementById('resultsGrid').innerHTML = '';

            try {
                const response = await fetch(`/api/players/search/${encodeURIComponent(query)}`);
                const data = await response.json();

                document.getElementById('loading').classList.add('d-none');

                if (data.results && data.results.length > 0) {
                    renderPlayers(data.results);
                } else {
                    document.getElementById('resultsGrid').innerHTML = `
                        <div class="col-12 text-center py-5">
                            <p class="text-muted">No results found for "${query}"</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error(error);
                document.getElementById('loading').classList.add('d-none');
            }
        }

        function renderPlayers(players) {
            const grid = document.getElementById('resultsGrid');
            grid.innerHTML = players.map(player => `
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="card h-100 shadow-2 player-card" onclick="viewPlayer('${player.id}')">
                        <div class="bg-image hover-overlay ripple" data-mdb-ripple-init data-mdb-ripple-color="light">
                            <div style="height: 200px; background: #eee; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user fa-5x text-silver"></i>
                            </div>
                            <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title fw-bold mb-0 text-truncate" style="max-width: 70%">${player.name || 'Unknown'}</h5>
                                <span class="badge badge-primary rounded-pill">${player.age || 'N/A'} yrs</span>
                            </div>
                            <p class="card-text text-muted small mb-3">
                                <i class="fas fa-futbol me-1"></i> ${player.position || 'Professional'}
                            </p>
                            <div class="border-top pt-3 mt-auto">
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted small">Market Value</span>
                                    <span class="market-value-text">${formatMarketValue(player.marketValue)}</span>
                                </div>
                                <div class="text-muted small mt-1 text-truncate">
                                    <i class="fas fa-shield-alt me-1"></i> ${player.club?.name || 'No Club'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function viewPlayer(id) {
            const content = document.getElementById('modalContent');
            playerModal.show();

            content.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-3">Analyzing scouting data...</p>
                </div>
            `;

            try {
                const [profile, market, stats] = await Promise.all([
                    fetch(`/api/players/${id}/profile`).then(r => r.json()),
                    fetch(`/api/players/${id}/market_value`).then(r => r.json()),
                    fetch(`/api/players/${id}/stats`).then(r => r.json())
                ]);

                // Update Title
                document.getElementById('modalTitle').innerText = profile.name;

                content.innerHTML = `
                    <div class="row">
                        <div class="col-lg-4 text-center mb-4">
                            <div class="bg-light rounded-4 shadow-2 overflow-hidden mb-4">
                                <img src="${profile.imageUrl || 'https://via.placeholder.com/400x500?text=No+Photo'}" 
                                     class="img-fluid w-100" style="object-fit: cover;">
                            </div>
                            <div class="card shadow-0 border mb-3">
                                <div class="card-body p-3">
                                    <p class="text-muted small text-uppercase mb-1">Market Valuation</p>
                                    <h4 class="fw-bold market-value-text mb-0">${formatMarketValue(market.marketValue || profile.marketValue)}</h4>
                                </div>
                            </div>
                            <div class="card shadow-0 border">
                                <div class="card-body p-3">
                                    <p class="text-muted small text-uppercase mb-1">Current Club</p>
                                    <h5 class="fw-bold text-indigo mb-0">${profile.club?.name || profile.currentClub || 'N/A'}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="mb-4">
                                <h3 class="fw-bold mb-3">${profile.name} <span class="text-muted fw-normal">#${profile.shirtNumber || ''}</span></h3>
                                <div class="row g-3">
                                    <div class="col-6 col-md-3">
                                        <div class="p-3 bg-light rounded-3">
                                            <p class="text-muted small mb-0">Age</p>
                                            <p class="fw-bold mb-0">${profile.age || 'N/A'}</p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="p-3 bg-light rounded-3">
                                            <p class="text-muted small mb-0">Height</p>
                                            <p class="fw-bold mb-0">${profile.height ? profile.height + 'cm' : 'N/A'}</p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="p-3 bg-light rounded-3">
                                            <p class="text-muted small mb-0">Foot</p>
                                            <p class="fw-bold mb-0">${profile.foot || 'Both'}</p>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="p-3 bg-light rounded-3">
                                            <p class="text-muted small mb-0">Nationality</p>
                                            <p class="fw-bold mb-0 truncate">${profile.citizenship?.[0] || 'N/A'}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <h5 class="fw-bold border-bottom pb-2 mb-3">Player Info</h5>
                                <ul class="list-unstyled">
                                    <li class="mb-2"><i class="fas fa-map-marker-alt me-2 text-primary"></i> <strong>Born:</strong> ${profile.birthDate || 'N/A'} (${profile.placeOfBirth?.city || ''})</li>
                                    <li class="mb-2"><i class="fas fa-file-contract me-2 text-primary"></i> <strong>Contract Exp:</strong> ${profile.club?.contractExpires || 'N/A'}</li>
                                    <li class="mb-2"><i class="fas fa-user-friends me-2 text-primary"></i> <strong>Agent:</strong> ${profile.agent?.name || 'None'}</li>
                                </ul>
                            </div>

                            <div class="mb-4">
                                <h5 class="fw-bold border-bottom pb-2 mb-3">Performance (Last 5 Comps)</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover border">
                                        <thead class="bg-light">
                                            <tr>
                                                <th>Competition</th>
                                                <th class="text-center">Apps</th>
                                                <th class="text-center">Goals</th>
                                                <th class="text-center">Assists</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${stats.stats?.length > 0 ? stats.stats.slice(0, 5).map(s => `
                                                <tr>
                                                    <td><div class="fw-bold text-truncate" style="max-width: 200px">${s.competitionName}</div><div class="text-muted small">${s.seasonId}</div></td>
                                                    <td class="text-center align-middle">${s.appearances || 0}</td>
                                                    <td class="text-center align-middle text-success">${s.goals || 0}</td>
                                                    <td class="text-center align-middle">${s.assists || 0}</td>
                                                </tr>
                                            `).join('') : '<tr><td colspan="4" class="text-center text-muted py-3">No stats available</td></tr>'}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error(error);
                content.innerHTML = `<div class="alert alert-danger">Error loading player data.</div>`;
            }
        }
    </script>
</body>

</html>